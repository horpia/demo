(()=>{"use strict";var t=function(){function t(){this.items=new Set}return t.prototype.addItem=function(t){this.items.add(t)},t.prototype.load=function(){return t=this,e=void 0,i=function(){return function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}(this,(function(t){switch(t.label){case 0:return[4,Promise.all(Array.from(this.items).map((function(t){return t.loadAssets()})))];case 1:return t.sent(),[2]}}))},new((n=void 0)||(n=Promise))((function(r,o){function s(t){try{h(i.next(t))}catch(t){o(t)}}function a(t){try{h(i.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}h((i=i.apply(t,e||[])).next())}));var t,e,n,i},t}(),e=top.innerWidth<900,n="./assets",i="DOSFont16",r="DOSFont8",o=320,s=240,a=o<<(e?0:1),h=s<<(e?0:1),l=256,c="#8c97a6",u="#ffffff",f="r796name",p="#8c97a6",d="#ffffff",y=[120,60,90,10],v="#ffffff",m="#8c97a6",g="#ffffff",w=Math.round(1e3/24),b=10.5,x="#2a2c34",S=["#ff0000","#ff3300","#ff6600","#ff9900","#ffcc66","#ffff99"],T=["#ff0000","#ff5500"],k=["#660000","#990000"],I=["#ccffff","#33ff99","#ffff33","#ff99ff"],C=["#993300","#003399","#660066","#006633"],M=20,E="#ffffff",P="#2a2c34",A=["#41464f","#353941"],L=["#97deff","#a3ff97"],R=["#bbb","#ddd"],B=[0,1,2,8,4,3,2,2,1,4,3,8,8,0,2,1,4],W=new Map([[6,{sprites:2,duration:500}],[12,{sprites:3,duration:1e3}]]),Y=240,H=new Map([[0,0],[15,1],[30,2],[45,3],[60,4],[75,5],[-15,6],[-30,7],[-45,8],[-60,9],[-75,10]]),X=120,D={img:12,shape:[]},K={img:13,shape:[]},F=[{img:5,shape:[[1,1,1,1],[0,0,0,0],[0,0,0,0]]},{img:6,shape:[[0,0,0,0],[1,1,1,1],[0,0,0,0]]},{img:7,col:0,x:10,shape:[[0,0,0,0],[0,0,0,0],[1,0,0,0]]},{img:7,col:1,x:10,shape:[[0,0,0,0],[0,0,0,0],[0,1,0,0]]},{img:7,col:2,x:10,shape:[[0,0,0,0],[0,0,0,0],[0,0,1,0]]},{img:7,col:3,x:10,shape:[[0,0,0,0],[0,0,0,0],[0,0,0,1]]},{img:9,col:1,x:40,shape:[[0,0,0,0],[0,1,1,1],[0,1,0,0]]},{img:9,col:2,x:40,shape:[[0,0,0,0],[0,0,1,1],[0,0,1,0]]},{img:9,col:3,x:40,shape:[[0,0,0,0],[0,0,0,1],[0,0,0,1]]},{img:9,col:0,x:40,flipped:!0,shape:[[0,0,0,0],[1,0,0,0],[1,0,0,0]]},{img:9,col:1,x:40,flipped:!0,shape:[[0,0,0,0],[1,1,0,0],[0,1,0,0]]},{img:9,col:2,x:40,flipped:!0,shape:[[0,0,0,0],[1,1,1,0],[0,0,1,0]]},{img:10,col:1,x:40,shape:[[0,1,1,1],[0,1,0,0],[0,1,0,0]]},{img:10,col:2,x:40,shape:[[0,0,1,1],[0,0,1,0],[0,0,1,0]]},{img:10,col:3,x:40,shape:[[0,0,0,1],[0,0,0,1],[0,0,0,1]]},{img:10,col:0,x:40,flipped:!0,shape:[[1,0,0,0],[1,0,0,0],[1,0,0,0]]},{img:10,col:1,x:40,flipped:!0,shape:[[1,1,0,0],[0,1,0,0],[0,1,0,0]]},{img:10,col:2,x:40,flipped:!0,shape:[[1,1,1,0],[0,0,1,0],[0,0,1,0]]},{img:11,col:1,x:60,shape:[[0,0,0,0],[0,0,0,0],[0,1,1,1]]},{img:11,col:2,x:60,shape:[[0,0,0,0],[0,0,0,0],[0,0,1,1]]},{img:11,col:3,x:60,shape:[[0,0,0,0],[0,0,0,0],[0,0,0,1]]},{img:11,col:0,x:60,flipped:!0,shape:[[0,0,0,0],[0,0,0,0],[1,0,0,0]]},{img:11,col:1,x:60,flipped:!0,shape:[[0,0,0,0],[0,0,0,0],[1,1,0,0]]},{img:11,col:2,x:60,flipped:!0,shape:[[0,0,0,0],[0,0,0,0],[1,1,1,0]]}],z=function(){function t(){var t=this;this.started=!1,this.timerId=0,this.list=new Set,this.interrupt=function(){window.clearTimeout(t.timerId),t.list.forEach((function(t){return t.interrupt()})),t.started&&(t.timerId=window.setTimeout(t.interrupt,w))}}return t.prototype.start=function(){this.stop(),this.started=!0,this.timerId=window.setTimeout(this.interrupt,w)},t.prototype.stop=function(){window.clearTimeout(this.timerId),this.started=!1},t.prototype.addItem=function(t){this.list.add(t)},t.prototype.removeItem=function(t){this.list.delete(t)},t}(),U=function(){function t(){var t=this;this.pressedKeys=new Set,this.handlers=new Set,this.handleKeyUp=function(e){e instanceof KeyboardEvent?t.pressedKeys.delete(e.code):e instanceof CustomEvent&&t.pressedKeys.delete(e.detail)},this.handleKeyDown=function(e){e instanceof KeyboardEvent?t.pressedKeys.add(e.code):e instanceof CustomEvent&&t.pressedKeys.add(e.detail)}}return t.prototype.clearPressedKeys=function(){this.pressedKeys.clear()},t.prototype.addHandler=function(t){this.handlers.add(t)},t.prototype.removeHandler=function(t){this.handlers.delete(t)},t.prototype.interrupt=function(){var t=this;this.handlers.forEach((function(e){return e.handle(t.pressedKeys)}))},t.prototype.attach=function(){document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp),document.addEventListener("custom-keydown",this.handleKeyDown),document.addEventListener("custom-keyup",this.handleKeyUp)},t.prototype.detach=function(){document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),document.removeEventListener("custom-keydown",this.handleKeyDown),document.removeEventListener("custom-keyup",this.handleKeyUp)},t}(),O=function(){function t(){this.displayCanvas=document.createElement("canvas"),this.displayCanvas.width=a,this.displayCanvas.height=h,this.displayCtx=this.displayCanvas.getContext("2d",{alpha:!1}),this.displayCtx.imageSmoothingEnabled=!1,this.displayCtx.mozImageSmoothingEnabled=!1,this.displayCtx.webkitImageSmoothingEnabled=!1,this.bufferCanvas=document.createElement("canvas"),this.bufferCanvas.width=o,this.bufferCanvas.height=s,this.bufferCanvas.style.cssText="font-smooth: never;  -webkit-font-smoothing : none;",this.bufferCtx=this.bufferCanvas.getContext("2d",{alpha:!1}),this.bufferCtx.imageSmoothingEnabled=!1,this.bufferCtx.mozImageSmoothingEnabled=!1,this.bufferCtx.webkitImageSmoothingEnabled=!1}return t.prototype.build=function(){},t.prototype.getElement=function(){return this.displayCanvas},t.prototype.clear=function(){this.bufferCtx.clearRect(0,0,this.bufferCanvas.width,this.bufferCanvas.height)},t.prototype.draw=function(t){this.bufferCtx.save(),t.render(this.bufferCtx),this.bufferCtx.restore()},t.prototype.finishFrame=function(){this.displayCtx.drawImage(this.bufferCanvas,0,0,this.displayCanvas.width,this.displayCanvas.height)},t}(),G=function(){function t(t){var e=this;this.canvas=t,this.started=!1,this.list=[],this.renderRequested=!0,this.render=function(){void 0!==e.requestId&&cancelAnimationFrame(e.requestId),e.renderRequested&&(e.renderRequested=!1,e.canvas.clear(),e.list.forEach((function(t){return e.canvas.draw(t)})),e.canvas.finishFrame()),e.started&&(e.requestId=requestAnimationFrame(e.render))}}return t.prototype.start=function(){this.stop(),this.started=!0,this.requestId=requestAnimationFrame(this.render)},t.prototype.stop=function(){void 0!==this.requestId&&cancelAnimationFrame(this.requestId),this.started=!1},t.prototype.addItem=function(t){this.list.includes(t)||(this.list.push(t),this.renderRequested=!0)},t.prototype.removeItem=function(t){var e=this.list.indexOf(t);e<0||(this.list.splice(e,1),this.renderRequested=!0)},t.prototype.requestRender=function(){this.renderRequested=!0},t}(),V=function(){function t(){}return t.prototype.loadAssets=function(){return t=this,e=void 0,s=function(){var t,e;return function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}(this,(function(o){switch(o.label){case 0:return t=new FontFace(i,"url(".concat(n,"/ModernDOS8x14.woff2)")),e=new FontFace(r,"url(".concat(n,"/ModernDOS8x8.woff2)")),[4,Promise.all([t.load(),e.load()])];case 1:return o.sent(),document.fonts.add(t),document.fonts.add(e),[2]}}))},new((o=void 0)||(o=Promise))((function(n,i){function r(t){try{h(s.next(t))}catch(t){i(t)}}function a(t){try{h(s.throw(t))}catch(t){i(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(r,a)}h((s=s.apply(t,e||[])).next())}));var t,e,o,s},t}(),N=function(){function t(){this.handlers=new Map}return t.prototype.addListener=function(t,e){this.handlers.has(t)||this.handlers.set(t,new Set),this.handlers.get(t).add(e)},t.prototype.removeListener=function(t,e){this.handlers.has(t)&&this.handlers.get(t).delete(e)},t.prototype.trigger=function(t,e){void 0===e&&(e=null);var n=this.handlers.get(t);n&&n.forEach((function(t){return t(e)}))},t}(),q=function(){function t(){this.shiftX=0,this.shiftY=0,this.farShiftX=0,this.farShiftY=0,this.events=new N,this.centerX=160,this.centerY=120,this.farRect=[this.centerX-8,this.centerY-6,this.centerX+8,this.centerY+6],this.nearRect=[this.centerX-192,this.centerY-144,this.centerX+192,this.centerY+144]}return t.prototype.reset=function(){this.shiftX=0,this.shiftY=0,this.farShiftX=0,this.farShiftY=0},t.prototype.moveNearRect=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.shiftX=Math.min(110,Math.max(-110,this.shiftX+t)),this.shiftY=Math.min(70,Math.max(-60,this.shiftY+e)),this.events.trigger("change")},t.prototype.moveFarRect=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.farShiftX+=t,this.farShiftY+=e,this.events.trigger("change")},t.prototype.getFarRect=function(){var t=this.farRect;return{left:t[0]+this.farShiftX,top:t[1]+this.farShiftY,right:t[2]+this.farShiftX,bottom:t[3]+this.farShiftY,width:t[2]-t[0],height:t[3]-t[1]}},t.prototype.getNearRect=function(){var t=this.nearRect;return{left:t[0]+this.shiftX,top:t[1]+this.shiftY,right:t[2]+this.shiftX,bottom:t[3]+this.shiftY,width:t[2]-t[0],height:t[3]-t[1]}},t}(),j=function(){this.value=0},_=new Map;function Q(t){return _.has(t)?Promise.resolve(_.get(t)):new Promise((function(e,n){var i=new Image;i.crossOrigin="anonymous",i.src=t,i.onerror=function(){return n()},i.onload=function(){return e(i)},_.set(t,i)}))}var J=function(){function t(t){this.position=t}return t.prototype.render=function(t){var e=Math.floor(.05*this.position.value)%this.img.naturalHeight;0===e?t.drawImage(this.img,0,0):(t.drawImage(this.img,0,e,this.img.naturalWidth,this.img.naturalHeight-e,0,0,this.img.naturalWidth,this.img.naturalHeight-e),t.drawImage(this.img,0,0,this.img.naturalWidth,e,0,this.img.naturalHeight-e,this.img.naturalWidth,e))},t.prototype.loadAssets=function(){return t=this,e=void 0,r=function(){var t;return function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}(this,(function(e){switch(e.label){case 0:return t=this,[4,Q("".concat(n,"/space-bg.gif"))];case 1:return t.img=e.sent(),[2]}}))},new((i=void 0)||(i=Promise))((function(n,o){function s(t){try{h(r.next(t))}catch(t){o(t)}}function a(t){try{h(r.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}h((r=r.apply(t,e||[])).next())}));var t,e,i,r},t}();function Z(t){return 0===t?0:Math.pow(2,10*t-10)}var $,tt=function(){return tt=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},tt.apply(this,arguments)},et=function(){function t(t,e){this.fov=t,this.position=e,this.lastPosition=0,this.lines=[],this.calcLines()}return t.prototype.render=function(t){this.drawHorizon(t),this.drawLines(t),this.drawShadow(t,!0),this.drawShadow(t,!1),this.drawRay(t,0),this.drawRay(t,.25),this.drawRay(t,.5),this.drawRay(t,.75),this.drawRay(t,1)},t.prototype.interrupt=function(){this.calcLines()},t.prototype.drawLines=function(t){for(var e=0,n=this.lines;e<n.length;e++){var i=n[e];t.fillStyle=i.color,t.fillRect(0,i.y,o,i.height)}this.lastPosition=this.position.value},t.prototype.drawHorizon=function(t){var e=this.fov.getFarRect();t.fillStyle="#000",t.fillRect(0,e.bottom-6,o,6)},t.prototype.drawShadow=function(t,e){var n=this.fov.getFarRect(),i=this.fov.getNearRect(),r=e?n.left:n.right,o=2*(r-(e?i.left:i.right)),s=2*(n.bottom-i.bottom);t.fillStyle="#2a2c34",t.beginPath(),t.moveTo(r,n.bottom),t.lineTo(r-o,n.bottom-s),t.lineTo(r-o,n.bottom),t.fill()},t.prototype.drawRay=function(t,e){for(var n=this.fov.getFarRect(),i=this.fov.getNearRect(),r=n.left+n.width*e,o=i.left+i.width*e-r,s=0,a=this.lines;s<a.length;s++){var h=a[s],l=4*h.scale;t.globalAlpha=Math.min(1,l);var c=(l=Math.min(4,Math.max(1,Math.round(l))))>>1;t.fillStyle=L[h.index%L.length],t.fillRect(r+o*h.scale-c,h.y-c,l,l)}},t.prototype.calcLines=function(){var t=this.fov.getFarRect(),e=this.fov.getNearRect(),n=Math.ceil(t.bottom),i=Math.ceil(e.bottom-n);this.lines=[];for(var r=this.position.value%80,o=function(t){var e=(40*t+r)/800,o=Z(e);return{index:t,y:Math.floor(n+o*i),height:0,scale:o,fovScale:e,color:A[t%A.length]}},s=0;s<=26;s++){var a=o(s);this.lines.push(tt(tt({},a),{height:o(s+1).y-a.y}))}},t}(),nt=function(){function t(t){this.fov=t,this.angle=0,this.scale=.5,this.moveByX=0,this.lastMoveByX=0,this.moveByY=0,this.rotateMode=!1,this.offsetYAngle=0,this.offsetY=0,this.hp=200}return t.prototype.reset=function(){this.hp=200,this.angle=0,this.scale=.5,this.moveByX=0,this.lastMoveByX=0,this.moveByY=0,this.offsetYAngle=0,this.offsetY=0,this.rotateMode=!1},t.prototype.damage=function(t){this.hp=Math.max(0,this.hp-t)},t.prototype.getHP=function(){return this.hp},t.prototype.rotate=function(){this.rotateMode=!0},t.prototype.move=function(t,e){this.moveByX=Math.sign(t),this.moveByY=Math.sign(e)},t.prototype.interrupt=function(){0===this.moveByX&&0===this.moveByY||this.fov.moveNearRect(7*this.moveByX,7*this.moveByY),this.rotateMode?this.angle=Math.max(-90,Math.min(90,this.angle+7.5*-(this.lastMoveByX||this.moveByX||1))):0!==this.moveByX&&Math.abs(this.angle)<=30?(this.angle=Math.max(-30,Math.min(30,this.angle+7.5*-this.moveByX)),this.lastMoveByX=this.moveByX):0!==this.angle&&(this.angle-=7.5*Math.sign(this.angle)),this.moveByX=0,this.moveByY=0,this.rotateMode=!1,this.offsetYAngle=(this.offsetYAngle+10)%360,this.offsetY=Math.round(4*Math.sin(this.offsetYAngle*Math.PI/180))},t.prototype.loadAssets=function(){return t=this,e=void 0,r=function(){var t;return function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}(this,(function(e){switch(e.label){case 0:return t=this,[4,Q("".concat(n,"/ship.gif"))];case 1:return t.img=e.sent(),[2]}}))},new((i=void 0)||(i=Promise))((function(n,o){function s(t){try{h(r.next(t))}catch(t){o(t)}}function a(t){try{h(r.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}h((r=r.apply(t,e||[])).next())}));var t,e,i,r},t.prototype.render=function(t){var e=this.getSpriteXY(),n=this.fov.getNearRect(),i=Math.floor(Y*this.scale),r=n.left+(n.width>>1),o=n.top+(n.height>>1),s=160+Math.round(.2*(160-r))-(i>>1),a=120+Math.round(.2*(120-o))+50-(i>>1)+this.offsetY;t.drawImage(this.img,e.x,e.y,Y,Y,s,a,i,i)},t.prototype.getSpriteXY=function(){for(var t=Number.MAX_VALUE,e=0,n=0,i=Array.from(H.entries());n<i.length;n++){var r=i[n],o=r[0],s=r[1],a=Math.abs(this.angle-o);a<t&&(t=a,e=s)}return{x:e*Y,y:Math.floor(Date.now()/40)%2*Y}},t}(),it=function(){function t(){this.lastBarriers=[]}return t.prototype.generate=function(){this.barrierMap=[[0,0,0,0],[0,0,0,0],[0,0,0,0]];for(var e=100,n=[];e-- >0;)n.push(t.createPathLine()),this.increaseBarrierMap(),n.push(t.createPathLine(this.pickBarrier())),this.increaseBarrierMap();for(var i=0;i<5;i++)n.push(t.createPathLine());for(this.createCoins(n),i=0;i<10;i++)n.unshift(t.createPathLine());return n[0].barrier=D,n.push(t.createPathLine(K)),n},t.createPathLine=function(t){return void 0===t&&(t=void 0),{coins:[[0,0,0,0],[0,0,0,0],[0,0,0,0]],barrier:t}},t.prototype.createCoins=function(t){for(var e=0;e<t.length;){for(var n=e+2+Math.round(5*Math.random()),i=[[0,0,0,0],[0,0,0,0],[0,0,0,0]],r=e;r<t.length&&r<=n;r++)if(void 0!==t[r].barrier)for(var o=t[r].barrier,s=0;s<o.shape.length;s++)for(var a=0;a<o.shape[s].length;a++)1===o.shape[s][a]&&(i[s][a]=1);var h=void 0,l=void 0;for(r=2;r>=0;r--)if(void 0!==(h=i[r].map((function(t,e){return t>0?-1:e})).filter((function(t){return t>=0})).sort((function(){return-2+Math.ceil(4*Math.random())})).shift())){l=r;break}if(void 0!==h)for(r=e;r<t.length&&r<=n;r++)t[r].coins[l][h]=1;e=n}},t.prototype.increaseBarrierMap=function(){for(var t=0;t<this.barrierMap.length;t++)for(var e=0;e<this.barrierMap[t].length;e++)this.barrierMap[t][e]++},t.prototype.pickBarrier=function(){var t=this,e=[];t:for(var n=0,i=F;n<i.length;n++){for(var r=i[n],o=0;o<r.shape.length;o++)for(var s=0;s<r.shape[o].length;s++)if(1===r.shape[o][s]&&this.barrierMap[o][s]<5)continue t;e.push(r)}0===e.length&&e.push.apply(e,F),0===(e=e.filter((function(e){return!t.lastBarriers.includes(e)}))).length&&e.push.apply(e,F);var a=e[Math.floor(e.length*Math.random())];for(this.lastBarriers.push(a),this.lastBarriers.length>8&&this.lastBarriers.splice(0,1),o=0;o<a.shape.length;o++)for(s=0;s<a.shape[o].length;s++)1===a.shape[o][s]&&(this.barrierMap[o][s]=0);return a},t}(),rt=function(){function t(){this.collisionTestCanvas=document.createElement("canvas"),this.collisionTestCanvas.width=o,this.collisionTestCanvas.height=s}return t.prototype.testWithCoins=function(t,e){var n=this.collisionTestCanvas.getContext("2d");n.clearRect(0,0,o,s),n.globalCompositeOperation="source-over",n.save(),t(n),n.restore(),n.globalCompositeOperation="source-in",n.save(),e.render(n),n.restore();for(var i=n.getImageData(0,0,o,s).data,r=0,a=3;a<i.length;a+=4)i[a]>=200&&r++;return r>3},t.prototype.testWithBarrier=function(t,e){var n=this.collisionTestCanvas.getContext("2d");n.clearRect(0,0,o,s),n.globalCompositeOperation="source-over",n.save(),t(n),n.restore(),n.globalCompositeOperation="source-in",n.save(),e.render(n),n.restore();for(var i=n.getImageData(0,0,o,s).data,r=new Map,a=Math.pow(20,2),h=3;h<i.length;h+=4)if(!(i[h]<200)){var l=h>>2,c=Math.floor(l/o),u=l-c*o,f=(65535&20*Math.floor(c/20)+10)<<16|65535&20*Math.floor(u/20)+10;r.set(f,(r.get(f)||0)+1)}for(var p=[],d=0,y=Array.from(r.entries());d<y.length;d++){var v=y[d],m=(f=v[0],v[1]);m>=3&&p.push({x:65535&f,y:f>>16&65535,strength:Math.min(1,m/a)})}return p},t}();!function(t){t[t.LEFT=0]="LEFT",t[t.CENTER=1]="CENTER",t[t.RIGHT=2]="RIGHT"}($||($={}));var ot,st=function(){function t(t,e,n,i){this.fov=t,this.position=e,this.ship=n,this.coins=i,this.lastPosition=-1,this.walls=[],this.images=[],this.imagesFlipped=[],this.initPathLength=0,this.passedPathItems=0,this.readyValue=0,this.events=new N,this.reset()}return Object.defineProperty(t.prototype,"pathPercent",{get:function(){return 0===this.initPathLength?0:Math.min(100,Math.round(this.passedPathItems/this.initPathLength*100))},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this.walls=[],this.lastPosition=-1,this.path=(new it).generate(),this.passedPathItems=0,this.initPathLength=this.path.length,this.collisionTester=new rt,this.calcWalls()},t.prototype.loadAssets=function(){return t=this,e=void 0,r=function(){var t,e,i,r,o,s,a,h,l,c;return function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}(this,(function(u){switch(u.label){case 0:for(t=[],e=1;e<=14;e++)t.push(Q("".concat(n,"/build").concat(e,".gif")));return r=(i=(l=this.images).push).apply,o=[l],[4,Promise.all(t)];case 1:return r.apply(i,o.concat([u.sent()])),a=(s=(c=this.imagesFlipped).push).apply,h=[c],[4,Promise.all(this.images.map((function(t){return function(t,e,n){var i=document.createElement("canvas");i.width=t.naturalWidth,i.height=t.naturalHeight;var r=i.getContext("2d");return r.translate(t.naturalWidth,0),r.scale(-1,1),r.drawImage(t,0,0),new Promise((function(t){var e=new Image;e.src=i.toDataURL("image/png"),e.onload=function(){return t(e)}}))}(t)})))];case 2:return a.apply(s,h.concat([u.sent()])),[2]}}))},new((i=void 0)||(i=Promise))((function(n,o){function s(t){try{h(r.next(t))}catch(t){o(t)}}function a(t){try{h(r.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}h((r=r.apply(t,e||[])).next())}));var t,e,i,r},t.prototype.interrupt=function(){this.lastPosition!==this.position.value&&this.calcWalls()},t.prototype.render=function(t){for(var e,n,i,r,o=this.ship.getHP()<=0,s=this.walls.length-1;s>=0;s--){var a=this.walls[s];!o&&a.sizeScale>.94&&(a.testCollision&&(this.passedPathItems++,a.testCollision=!1,(null===(e=a.pathItem)||void 0===e?void 0:e.coins)&&this.testCollisionWithCoins(a),(null===(n=a.pathItem)||void 0===n?void 0:n.barrier)&&(this.testCollisionWithBarrier(a),a.pathItem.barrier===K&&this.events.trigger("finish"))),o=!0,this.drawShip(t)),t.save(),t.filter="brightness(".concat(a.brightness,"%)"),void 0!==a.imgLeft&&this.drawWall(t,a,a.imgLeft,$.LEFT),void 0!==a.imgRight&&this.drawWall(t,a,a.imgRight,$.RIGHT),(null===(i=a.pathItem)||void 0===i?void 0:i.barrier)&&this.drawWall(t,a,a.pathItem.barrier.img,$.CENTER,a.pathItem.barrier),(null===(r=a.pathItem)||void 0===r?void 0:r.coins)&&this.drawCoins(a,t),t.restore()}o||this.drawShip(t)},t.prototype.explodeShip=function(){this.testCollisionWithBarrier()},t.prototype.testCollisionWithBarrier=function(t){var e=this;this.collisionTester.testWithBarrier((function(n){t?e.drawWall(n,t,t.pathItem.barrier.img,$.CENTER,t.pathItem.barrier):(n.fillStyle="red",n.fillRect(0,0,o,s))}),this.ship).forEach((function(n){e.events.trigger("explosion",[n.x,n.y,n.strength,!!t])}))},t.prototype.testCollisionWithCoins=function(t){var e=this;this.collisionTester.testWithCoins((function(n){e.coins.setProps(t.left,t.y,t.sizeScale,t.pathItem.coins),e.coins.render(n)}),this.ship)&&(t.pathItem.coins=t.pathItem.coins.map((function(t){return t.map((function(t){return 1===t?2:t}))})),this.events.trigger("get-coin"))},t.prototype.drawCoins=function(t,e){e.save(),this.coins.setProps(t.left,t.y,t.sizeScale,t.pathItem.coins),this.coins.render(e),e.restore()},t.prototype.drawShip=function(t){t.save(),this.ship.render(t),t.restore()},t.prototype.drawWall=function(t,e,n,i,r){var o=W.get(n)||{sprites:1,duration:1},s=o.sprites,a=o.duration,h=e.sizeScale*(i===$.CENTER?1:1.4),l=i===$.RIGHT||(null==r?void 0:r.flipped)?this.imagesFlipped[n]:this.images[n],c=l.naturalWidth/s,u=Math.floor(Date.now()/a)%s*c,f=Math.floor(c*h),p=Math.floor(l.naturalHeight*h),d=e.left,y=e.y-p;if(n===D.img&&(u=Math.min(s-1,this.readyValue)*c),(null==r?void 0:r.col)>0){var v=this.fov.getNearRect(),m=this.fov.getFarRect(),g=(v.width-m.width)/4*e.sizeScale;d+=Math.round(g*r.col),(null==r?void 0:r.flipped)?(d-=f,d-=Math.round(r.x?r.x*e.sizeScale:0)):d+=Math.round(r.x?r.x*e.sizeScale:0)}i===$.LEFT?d=e.left-f:i===$.RIGHT&&(d=e.right),t.drawImage(l,u,0,c,l.naturalHeight,d,y,f,p)},t.prototype.calcWalls=function(){if(0!==this.images.length){var t=this.fov.getFarRect(),e=this.fov.getNearRect(),n=Math.ceil(t.bottom),i=Math.ceil(e.bottom-n),r=Math.floor(this.position.value/40),o=Math.ceil(20),s=r+o;this.walls=this.walls.filter((function(t){return t.id>=r&&t.id<=s}));for(var a=Math.max.apply(Math,function(t,e,n){if(n||2===arguments.length)for(var i,r=0,o=e.length;r<o;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))}([0],this.walls.map((function(t){return t.id})),!1)),h=a+1;h<=s;h++)this.walls.push({id:h,y:0,left:0,right:0,sizeScale:1,fovScale:1,brightness:100,position:40*h,color:R[h%R.length],imgLeft:B[h%B.length],imgRight:B[(h+4)%B.length],pathItem:this.path.shift(),testCollision:!0});for(var l=0,c=this.walls;l<c.length;l++){var u=c[l],f=Z(1-(u.position-this.position.value)/800);u.fovScale=f,u.brightness=Math.round(Math.min(100,1e3*f)),u.sizeScale=.05+.95*f,u.y=n+f*i,u.left=t.left+f*(e.left-t.left),u.right=t.right+f*(e.right-t.right)}}},t}(),at=function(){function t(t){this.ship=t}return t.prototype.handle=function(t){var e=0,n=0;t.has("ArrowLeft")?e=1:t.has("ArrowRight")&&(e=-1),t.has("ArrowUp")?n=1:t.has("ArrowDown")&&(n=-1),0===e&&0===n||this.ship.move(e,n),t.has("Space")&&this.ship.rotate()},t}(),ht=function(){function t(t,e,n){this.x=t,this.y=e,this.scale=n,this.frame=0,this.lastTime=0,this.events=new N,this.size=Math.floor(X*this.scale)}return t.prototype.interrupt=function(){var t=Date.now();t-this.lastTime<80||(this.lastTime=t,this.frame++,this.frame>=8&&this.events.trigger("end"))},t.prototype.loadAssets=function(){return t=this,e=void 0,r=function(){var t;return function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}(this,(function(e){switch(e.label){case 0:return t=this,[4,Q("".concat(n,"/expl1.gif"))];case 1:return t.img=e.sent(),[2]}}))},new((i=void 0)||(i=Promise))((function(n,o){function s(t){try{h(r.next(t))}catch(t){o(t)}}function a(t){try{h(r.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}h((r=r.apply(t,e||[])).next())}));var t,e,i,r},t.prototype.render=function(t){var e=this.size>>1;t.drawImage(this.img,this.frame*X,0,X,X,this.x-e,this.y-e,this.size,this.size)},t}(),lt=function(){function t(t,e){this.ship=t,this.coins=e,this.hp=0,this.finishPercent=0}return t.prototype.reset=function(){this.hp=0},t.prototype.setFinishPercent=function(t){this.finishPercent=t},t.prototype.loadAssets=function(){return t=this,e=void 0,r=function(){var t;return function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}(this,(function(e){switch(e.label){case 0:return[4,Promise.all([Q("".concat(n,"/coin.gif")),Q("".concat(n,"/finish.gif"))])];case 1:return t=e.sent(),this.coinImg=t[0],this.finishImg=t[1],[2]}}))},new((i=void 0)||(i=Promise))((function(n,o){function s(t){try{h(r.next(t))}catch(t){o(t)}}function a(t){try{h(r.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}h((r=r.apply(t,e||[])).next())}));var t,e,i,r},t.prototype.interrupt=function(){if(this.ship.getHP()!==this.hp){var t=this.ship.getHP()-this.hp;this.hp+=Math.ceil(t/2)}},t.prototype.render=function(t){this.drawHp(t),this.drawCoins(t),this.drawFinish(t)},t.prototype.drawFinish=function(t){t.drawImage(this.finishImg,150,9),t.font='16px "'.concat(i,'"'),t.textBaseline="top",t.fillStyle=P,t.fillText("".concat(this.finishPercent,"%"),172,7),t.fillStyle=E,t.fillText("".concat(this.finishPercent,"%"),171,6)},t.prototype.drawCoins=function(t){t.drawImage(this.coinImg,0,0,M,M,250,10,10,10),t.font='16px "'.concat(i,'"'),t.textBaseline="top",t.fillStyle=P,t.fillText("".concat(this.coins.getScore()),266,7),t.fillStyle=E,t.fillText("".concat(this.coins.getScore()),265,6)},t.prototype.drawHp=function(e){e.fillStyle=x,t.setHpPath(e),e.fill();var n=this.hp/200,i=Math.floor(25),r=Math.round(i*n);e.fillStyle=S[Math.round(n*(S.length-1))],e.strokeStyle=x;for(var o=0;o<r;o++){var s=20.5+4*o;e.beginPath(),e.moveTo(s+4,b),e.lineTo(s+4+4,b),e.lineTo(s+4,16.5),e.lineTo(s,16.5),e.closePath(),e.fill(),e.stroke()}e.strokeStyle="#141518",t.setHpPath(e),e.stroke()},t.setHpPath=function(t){t.beginPath(),t.moveTo(24.5,b),t.lineTo(124.5,b),t.lineTo(120.5,16.5),t.lineTo(20.5,16.5),t.closePath()},t}(),ct=function(){function t(t){this.fov=t,this.lineX=0,this.lineY=0,this.scale=1,this.score=0}return t.prototype.reset=function(){this.score=0},t.prototype.loadAssets=function(){return t=this,e=void 0,r=function(){var t;return function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}(this,(function(e){switch(e.label){case 0:return t=this,[4,Q("".concat(n,"/coin.gif"))];case 1:return t.img=e.sent(),[2]}}))},new((i=void 0)||(i=Promise))((function(n,o){function s(t){try{h(r.next(t))}catch(t){o(t)}}function a(t){try{h(r.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}h((r=r.apply(t,e||[])).next())}));var t,e,i,r},t.prototype.getScore=function(){return this.score},t.prototype.setProps=function(t,e,n,i){this.lineX=t,this.lineY=e,this.scale=n,this.coins=i},t.prototype.render=function(t){if(this.img&&this.coins){var e=(this.fov.getNearRect().width>>2)*this.scale,n=e>>1,i=60*this.scale,r=i>>1,o=M*this.scale,s=o/2,a=M*(Math.floor(Date.now()/250)%4);t:for(var h=0;h<this.coins.length;h++)for(var l=0;l<this.coins[h].length;l++)if(0!==this.coins[h][l]){var c=0,u=1;if(this.coins[h][l]>1&&(2===this.coins[h][l]&&this.score++,c=10*this.coins[h][l],u=Math.min(1,Math.max(0,1-this.coins[h][l]/10)),this.coins[h][l]++),u<=0)break t;t.drawImage(this.img,a,0,M,M,this.lineX+l*e+n-s*u,this.lineY-(2-h)*i-r-s*u-c,o*u,o*u);break t}}},t}(),ut=function(){function t(){this.size=0}return t.prototype.interrupt=function(){this.size<4&&this.size++},t.prototype.render=function(t){var e=8*this.size,n="GAME OVER",r=Math.floor(Date.now()/500)%k.length;t.font="".concat(e,'px "').concat(i,'"'),t.textBaseline="top";var o=160-(t.measureText(n).width>>1),s=120-e;t.fillStyle=k[r],t.fillText(n,o+2,s+2),t.fillStyle=T[r],t.fillText(n,o,s)},t}(),ft=function(){function t(){this.size=0}return t.prototype.interrupt=function(){this.size<4&&this.size++},t.prototype.render=function(t){var e=8*this.size,n="FINISH!",r=Math.floor(Date.now()/100)%I.length;t.font="".concat(e,'px "').concat(i,'"'),t.textBaseline="top";var o=160-(t.measureText(n).width>>1),s=120-e;t.fillStyle=C[r],t.fillText(n,o+2,s+2),t.fillStyle=I[r],t.fillText(n,o,s)},t}(),pt=function(){function t(){this.size=0,this.reset()}return t.prototype.reset=function(){this.value="READY!",this.size=0,this.startTime=Date.now()},t.prototype.interrupt=function(){"READY!"===this.value&&Date.now()-this.startTime>1300&&(this.value="GO!",this.size=0),this.size<4&&this.size++},t.prototype.render=function(t){var e=8*this.size,n=this.value;t.font="".concat(e,'px "').concat(i,'"'),t.textBaseline="top";var r=160-(t.measureText(n).width>>1),o=120-e;t.fillStyle="#2a2c34",t.fillText(n,r+2,o+2),t.fillStyle="#ffffff",t.fillText(n,r,o)},t}(),dt=function(){function t(t,e,n,i){var r=this;this.interrupter=t,this.renderer=e,this.assetsLoader=n,this.keyboardController=i,this.fly=!1,this.startTimer=0,this.startTime=0,this.isFinish=!1,this.speed=0,this.events=new N;var o=new q;this.fieldOfView=o,this.position=new j,this.spaceBg=new J(this.position),this.floor=new et(o,this.position),this.ship=new nt(o),this.coins=new ct(o),this.walls=new st(o,this.position,this.ship,this.coins),this.shipController=new at(this.ship),this.topBar=new lt(this.ship,this.coins),this.gameOver=new ut,this.finishText=new ft,this.startTimerText=new pt,this.assetsLoader.addItem(this.spaceBg),this.assetsLoader.addItem(this.walls),this.assetsLoader.addItem(this.ship),this.assetsLoader.addItem(new ht(0,0,1)),this.assetsLoader.addItem(this.topBar),this.assetsLoader.addItem(this.coins),this.walls.events.addListener("explosion",(function(t){var e=t[0],n=t[1],i=t[2],o=t[3];r.addExplosion(e,n,i,o)})),this.walls.events.addListener("finish",(function(){r.fly&&(r.isFinish=!0,r.keyboardController.removeHandler(r.shipController),r.addItem(r.finishText),setTimeout((function(){r.events.trigger("save",r.coins.getScore())}),2e3))}))}return t.prototype.reset=function(){this.startTimer=0,this.isFinish=!1,this.speed=0,this.fieldOfView.reset(),this.fieldOfView.moveNearRect(0,-70),this.position.value=0,this.walls.reset(),this.ship.reset(),this.coins.reset(),this.topBar.reset(),this.startTimerText.reset()},t.prototype.attach=function(){this.interrupter.addItem(this),this.fly=!0,this.startTime=Date.now(),this.renderer.addItem(this.spaceBg),this.addItem(this.floor),this.addItem(this.walls),this.addItem(this.topBar),this.addItem(this.startTimerText),this.interrupter.addItem(this.ship)},t.prototype.detach=function(){this.fly=!1,this.keyboardController.removeHandler(this.shipController),this.renderer.removeItem(this.spaceBg),this.removeItem(this.floor),this.removeItem(this.walls),this.removeItem(this.topBar),this.removeItem(this.gameOver),this.removeItem(this.finishText),this.interrupter.removeItem(this.ship),this.startTimerText&&this.removeItem(this.startTimerText)},t.prototype.interrupt=function(){this.renderer.requestRender(),this.topBar.setFinishPercent(this.walls.pathPercent),this.fly&&this.position&&(this.startTimer<40?(40==++this.startTimer&&(this.keyboardController.addHandler(this.shipController),this.position.value=.5),this.walls.readyValue=Math.floor(this.startTimer/40*(W.get(D.img).sprites-1))):(this.startTimerText&&this.removeItem(this.startTimerText),this.isFinish?this.speed=Math.max(0,this.speed-.1):this.speed<5&&(this.speed=Math.min(5,this.speed+.5)),this.speed>0&&(this.position.value=(this.position.value+Math.floor(this.speed))%1e5)))},t.prototype.destroyShip=function(){var t=this;this.fly&&(this.fly=!1,this.keyboardController.removeHandler(this.shipController),this.addItem(this.gameOver),this.walls.explodeShip(),setTimeout((function(){t.events.trigger("close")}),2e3))},t.prototype.addItem=function(t){this.renderer.addItem(t),this.interrupter.addItem(t)},t.prototype.removeItem=function(t){this.renderer.removeItem(t),this.interrupter.removeItem(t)},t.prototype.addExplosion=function(t,e,n,i){return r=this,o=void 0,a=function(){var r,o=this;return function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}(this,(function(s){switch(s.label){case 0:return i&&(this.ship.damage(Math.round(30*n)),this.ship.getHP()<=0)?(this.fly&&this.destroyShip(),[2]):[4,(r=new ht(t,e,Math.max(.4,n))).loadAssets()];case 1:return s.sent(),this.addItem(r),r.events.addListener("end",(function(){o.removeItem(r)})),[2]}}))},new((s=void 0)||(s=Promise))((function(t,e){function n(t){try{h(a.next(t))}catch(t){e(t)}}function i(t){try{h(a.throw(t))}catch(t){e(t)}}function h(e){var r;e.done?t(e.value):(r=e.value,r instanceof s?r:new s((function(t){t(r)}))).then(n,i)}h((a=a.apply(r,o||[])).next())}));var r,o,s,a},t}(),yt=function(){function t(t){this.form=t}return t.prototype.handle=function(t){t.has("ArrowLeft")?this.form.moveFocus(-1,0):t.has("ArrowRight")&&this.form.moveFocus(1,0),t.has("ArrowUp")?this.form.moveFocus(0,-1):t.has("ArrowDown")&&this.form.moveFocus(0,1),(t.has("Space")||t.has("Enter"))&&this.form.applyKey()},t}(),vt=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{h(i.next(t))}catch(t){o(t)}}function a(t){try{h(i.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}h((i=i.apply(t,e||[])).next())}))},mt=function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},gt=function(){function t(){}return t.prototype.getList=function(){return vt(this,void 0,void 0,(function(){return mt(this,(function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,fetch("/addon/racer796/results")];case 1:return[4,t.sent().json()];case 2:return[2,t.sent()];case 3:return t.sent(),[3,4];case 4:return[2,[]]}}))}))},t.prototype.save=function(e,n){return vt(this,void 0,void 0,(function(){var i,r,o,s,a;return mt(this,(function(h){switch(h.label){case 0:i=t.generateKey(),r=t.generateSrcToken(i),o=t.shiftToken(n,r),s=encodeURIComponent(window.btoa(String.fromCharCode.apply(null,i))),a=encodeURIComponent(window.btoa(String.fromCharCode.apply(null,o))),h.label=1;case 1:return h.trys.push([1,4,,5]),[4,fetch("/addon/racer796/save",{method:"POST",mode:"cors",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"name=".concat(e,"&key=").concat(s,"&token=").concat(a)})];case 2:return[4,h.sent().json()];case 3:case 4:return h.sent(),[3,5];case 5:return[2]}}))}))},t.generateKey=function(){for(var t=16+Math.ceil(10*Math.random()),e=new Uint8Array(t),n=0;n<t;n++)e[n]=Math.floor(256*Math.random());return e},t.generateSrcToken=function(t){for(var e=navigator.userAgent.split("").map((function(t){return t.charCodeAt(0)})),n=new Uint8Array(l),i=0;i<l;i++){var r=t[i%t.length];n[i]=(r+(e[i%e.length]+i))%256}return n},t.shiftToken=function(t,e){for(var n=new Uint8Array(l),i=0;i<l;i++)n[i]=(e[i]+t)%256;return n},t}(),wt=["QWERTYUIOP","ASDFGHJKL'","ZXCVBNM.-_","1234567890"];!function(t){t.BACKSPACE="⟵",t.ENTER="✓"}(ot||(ot={}));var bt=function(){function t(t,e){this.renderer=t,this.keyboardController=e,this.text="",this.letterWidth=0,this.titleWidth=0,this.offsetX=0,this.offsetXLastTime=0,this.offsetXLastValue=0,this.offsetY=0,this.offsetYLastTime=0,this.offsetYLastValue=0,this.applyLastChar="",this.applyLastTime=0,this.selectedChar="Q",this.saveInProgress=!1,this.score=0,this.events=new N,this.keyboardHandler=new yt(this)}return t.prototype.attach=function(){this.text=String(window.localStorage.getItem(f)||"").substring(0,12),this.renderer.addItem(this),this.keyboardController.addHandler(this.keyboardHandler)},t.prototype.detach=function(){this.renderer.removeItem(this),this.keyboardController.removeHandler(this.keyboardHandler)},t.prototype.render=function(t){this.drawTitle(t),this.drawInput(t),this.drawKeyboard(t)},t.prototype.setScore=function(t){this.score=t},t.prototype.applyKey=function(){var t=this,e=Date.now();this.selectedChar===this.applyLastChar&&e-this.applyLastTime<100||(this.applyLastChar=this.selectedChar,this.applyLastTime=e,this.selectedChar===ot.BACKSPACE?this.text.length>0&&(this.text=this.text.substring(0,this.text.length-1)):this.selectedChar===ot.ENTER?this.saveInProgress||(this.saveInProgress=!0,this.save().then((function(){t.saveInProgress=!1}))):this.text.length<12&&(this.text+=this.selectedChar),this.renderer.requestRender())},t.prototype.save=function(){return t=this,e=void 0,i=function(){return function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}(this,(function(t){switch(t.label){case 0:return""===this.text?[3,2]:(window.localStorage.setItem(f,this.text),[4,(new gt).save(this.text,this.score)]);case 1:t.sent(),t.label=2;case 2:return this.events.trigger("saved"),[2]}}))},new((n=void 0)||(n=Promise))((function(r,o){function s(t){try{h(i.next(t))}catch(t){o(t)}}function a(t){try{h(i.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}h((i=i.apply(t,e||[])).next())}));var t,e,n,i},t.prototype.moveFocus=function(t,e){var n=Date.now();t===this.offsetXLastValue&&n-this.offsetXLastTime<100?t=0:(this.offsetXLastValue=t,this.offsetXLastTime=n),e===this.offsetYLastValue&&n-this.offsetYLastTime<100?e=0:(this.offsetYLastValue=e,this.offsetYLastTime=n),this.offsetX=Math.max(0,Math.min(wt[0].length,this.offsetX+t)),this.offsetY=Math.max(0,Math.min(wt.length-1,this.offsetY+e)),this.offsetX===wt[0].length?0===this.offsetY?this.selectedChar=ot.BACKSPACE:this.selectedChar=ot.ENTER:this.selectedChar=wt[this.offsetY].charAt(this.offsetX),this.renderer.requestRender()},t.prototype.drawTitle=function(t){var e="ENTER YOUR NAME";t.font="".concat(16,'px "').concat(i,'"'),0===this.titleWidth&&(this.titleWidth=t.measureText(e).width),t.textBaseline="top",t.fillStyle=c,t.fillText(e,160-(this.titleWidth>>1),8)},t.prototype.drawInput=function(t){t.font="".concat(32,'px "').concat(i,'"'),0===this.letterWidth&&(this.letterWidth=t.measureText("A").width);var e=160-(12*this.letterWidth>>1);t.strokeStyle=u,t.lineWidth=1;for(var n=0;n<12;n++){var r=e+n*this.letterWidth;t.beginPath(),t.moveTo(r+1,56.5),t.lineTo(r+this.letterWidth-2,56.5),t.stroke()}t.textBaseline="bottom",t.fillStyle=u,t.fillText(this.text,e,56)},t.prototype.drawKeyboard=function(t){t.font="".concat(32,'px "').concat(i,'"'),t.textBaseline="top",t.fillStyle=p,t.strokeStyle=p,this.drawKeys(!1,t),t.strokeStyle=d,t.fillStyle=d,this.drawKeys(!0,t)},t.prototype.drawKeys=function(t,e){for(var n=this.letterWidth+4+4,i=160-((wt[0].length+2)*n>>1),r=75,o=0;o<wt.length;o++){for(var s=wt[o],a=0;a<s.length;a++){var h=s.charAt(a);t&&h!==this.selectedChar||(e.fillText(s.charAt(a),i+a*n+4,r+2),e.strokeRect(i+a*n-.5,r-.5,n,36))}r+=36}var l=i+wt[0].length*n-.5;t&&"⟵"!==this.selectedChar||(e.strokeRect(l,74.5,n<<1,36),e.fillText(ot.BACKSPACE,l+4,77)),t&&"✓"!==this.selectedChar||(e.strokeRect(l,110.5,n<<1,108),e.fillText(ot.ENTER,l+(this.letterWidth>>1)+4,149))},t}(),xt=function(){function t(t){this.table=t}return t.prototype.handle=function(t){t.has("ArrowUp")?this.table.scroll(-1):t.has("ArrowDown")&&this.table.scroll(1),(t.has("Space")||t.has("Enter")||t.has("Escape"))&&this.table.close()},t}(),St=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{h(i.next(t))}catch(t){o(t)}}function a(t){try{h(i.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}h((i=i.apply(t,e||[])).next())}))},Tt=function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},kt=function(){function t(t,e,n){this.renderer=t,this.loader=e,this.keyboardController=n,this.titleWidth=0,this.recs=[],this.scrollY=0,this.loading=!1,this.events=new N,this.loader.addItem(this),this.keyboardHandler=new xt(this),this.tableWidth=y.reduce((function(t,e){return t+e}),0),this.tableX=160-(this.tableWidth>>1)}return t.prototype.loadAssets=function(){return St(this,void 0,void 0,(function(){var t;return Tt(this,(function(e){switch(e.label){case 0:return t=this,[4,Q("".concat(n,"/station-bg.gif"))];case 1:return t.bg=e.sent(),[2]}}))}))},t.prototype.attach=function(){this.renderer.addItem(this),this.keyboardController.addHandler(this.keyboardHandler),this.load().then()},t.prototype.detach=function(){this.renderer.removeItem(this),this.keyboardController.removeHandler(this.keyboardHandler)},t.prototype.render=function(t){t.drawImage(this.bg,0,0),this.drawTitle(t),this.drawTable(t),this.drawArrows(t)},t.prototype.scroll=function(t){this.scrollY=Math.max(0,Math.min(Math.max(0,this.recs.length-11),this.scrollY+t)),this.renderer.requestRender()},t.prototype.close=function(){this.events.trigger("close")},t.prototype.load=function(){return St(this,void 0,void 0,(function(){var t;return Tt(this,(function(e){switch(e.label){case 0:return this.loading=!0,t=this,[4,(new gt).getList()];case 1:return t.recs=e.sent(),this.loading=!1,this.renderer.requestRender(),[2]}}))}))},t.prototype.drawTitle=function(t){var e="TOP SCORES";t.font="".concat(16,'px "').concat(i,'"'),0===this.titleWidth&&(this.titleWidth=t.measureText(e).width),t.textBaseline="top",t.fillStyle=c,t.fillText(e,160-(this.titleWidth>>1),8)},t.prototype.drawTable=function(t){var e,n;if(t.font="".concat(16,'px "').concat(i,'"'),t.textBaseline="top",t.fillStyle=v,this.loading)t.fillText("loading...",this.tableX,30);else if(0!==this.recs.length)for(var r=0;r<11&&this.recs[this.scrollY+r];r++){var o=this.tableX,s=30+18*r,a=this.recs[this.scrollY+r];t.fillText(a.name,o,s),o+=y[0],t.fillText(String(a.score),o,s),o+=y[1],t.fillText(String((e=1e3*a.created_at,n=void 0,(n=new Date(e)).getFullYear()+"-"+String(n.getMonth()+1).padStart(2,"0")+"-"+String(n.getDate()).padStart(2,"0"))),o,s)}else t.fillText("no results yet...",this.tableX,30)},t.prototype.drawArrows=function(t){t.font="".concat(16,'px "').concat(i,'"'),t.textBaseline="top",t.fillStyle=v,this.scrollY>0&&t.fillText("▲",this.tableX+this.tableWidth-y[3],30),this.scrollY<this.recs.length-11&&t.fillText("▼",this.tableX+this.tableWidth-y[3],210)},t}(),It=function(){function t(t){this.menu=t}return t.prototype.handle=function(t){t.has("ArrowUp")?this.menu.moveSelection(-1):t.has("ArrowDown")&&this.menu.moveSelection(1),(t.has("Enter")||t.has("Space"))&&this.menu.applyMenu()},t}(),Ct=function(){function t(t,e,n,i){this.renderer=t,this.interrupter=e,this.loader=n,this.keyboardController=i,this.sprite=0,this.angle=0,this.stars=new Set,this.selectedMenu=0,this.events=new N,this.keyboardHandler=new It(this),this.loader.addItem(this),this.starsAngle=-69*Math.PI/180}return t.prototype.loadAssets=function(){return t=this,e=void 0,r=function(){var t;return function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}(this,(function(e){switch(e.label){case 0:return t=this,[4,Q("".concat(n,"/ship2.gif"))];case 1:return t.img=e.sent(),[2]}}))},new((i=void 0)||(i=Promise))((function(n,o){function s(t){try{h(r.next(t))}catch(t){o(t)}}function a(t){try{h(r.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}h((r=r.apply(t,e||[])).next())}));var t,e,i,r},t.prototype.moveSelection=function(t){this.selectedMenu=Math.min(1,Math.max(0,this.selectedMenu+t))},t.prototype.applyMenu=function(){0===this.selectedMenu?this.events.trigger("game"):this.events.trigger("top-scores")},t.prototype.attach=function(){this.renderer.addItem(this),this.interrupter.addItem(this),this.keyboardController.addHandler(this.keyboardHandler),this.generateStartupStars()},t.prototype.detach=function(){this.renderer.removeItem(this),this.interrupter.removeItem(this),this.keyboardController.removeHandler(this.keyboardHandler)},t.prototype.interrupt=function(){this.angle=(this.angle+10)%360,this.sprite=(this.sprite+1)%2,this.moveStars(),this.renderer.requestRender()},t.prototype.render=function(e){t.drawBg(e),this.drawStars(e),this.drawShip(e),this.drawMenuItems(e),t.drawCopyright(e)},t.prototype.generateStartupStars=function(){this.stars.clear();for(var t=0;t<80;t++)this.addStar()},t.prototype.moveStars=function(){for(var t=0,e=Array.from(this.stars);t<e.length;t++){var n=e[t];n.x+=15*n.z,n.x>480&&this.stars.delete(n)}for(var i=this.stars.size;i<80;i++)this.addStar(!0)},t.prototype.addStar=function(t){void 0===t&&(t=!1),this.stars.add({x:t?0:480*Math.random(),y:480*Math.random(),z:.2+.8*Math.random()})},t.prototype.drawStars=function(t){t.save(),t.translate(-100,240),t.rotate(this.starsAngle),t.fillStyle="#ffffff";for(var e=0,n=Array.from(this.stars);e<n.length;e++){var i=n[e];t.globalAlpha=i.z,t.fillRect(i.x,i.y,2,2)}t.restore()},t.drawBg=function(t){t.fillStyle="#232331",t.fillRect(0,0,o,s)},t.prototype.drawShip=function(t){var e=Math.round(6*Math.sin(this.angle*Math.PI/180)),n=this.img.naturalWidth/2;t.drawImage(this.img,n*this.sprite,0,n,this.img.naturalHeight,-20,-10+e,n,this.img.naturalHeight)},t.prototype.drawMenuItems=function(t){var e=["START","TOP SCORES"],n=190;t.font="".concat(16,'px "').concat(i,'"'),t.textBaseline="top";for(var r=0;r<e.length;r++)r===this.selectedMenu?t.fillStyle=g:t.fillStyle=m,t.fillText(e[r],210,n),n+=19;t.fillStyle=g,t.textAlign="right",t.fillText(">",207,190+19*this.selectedMenu),t.textAlign="left"},t.drawCopyright=function(t){t.font="".concat(32,'px "').concat(i,'"'),t.textBaseline="top",t.fillStyle="#4d5d6c",t.fillText("RACER-796",22,192),t.fillStyle="#d0eaff",t.fillText("RACER-796",20,190),t.font="".concat(16,'px "').concat(r,'"'),t.fillStyle=m,t.fillText("© floor796",20,214)},t}(),Mt={0:["ArrowDown"],1:["ArrowDown","ArrowRight"],2:["ArrowRight"],3:["ArrowUp","ArrowRight"],4:["ArrowUp"],5:["ArrowUp","ArrowLeft"],6:["ArrowLeft"],7:["ArrowDown","ArrowLeft"],8:["ArrowDown"]},Et=function(){function t(t){var e=this;this.keyboardController=t,this.spriteWidth=0,this.spriteHeight=0,this.spriteIndex=0,this.touchX=0,this.touchY=0,this.touchId=0,this.pressedVirtualKeys=new Set,this.handleTouchStart=function(t){if(0===e.touchId){var n=t.targetTouches[0];e.touchId=n.identifier,e.touchX=n.clientX,e.touchY=n.clientY}},this.handleTouchMove=function(t){t.preventDefault(),t.stopPropagation();var n=e.getTouchById(t.targetTouches);n&&e.pressVirtualKeys(e.touchX-n.clientX,e.touchY-n.clientY)},this.handleTouchEnd=function(t){e.getTouchById(t.targetTouches)||(e.touchId=0,e.releaseAllVirtualKeys())},this.handleMouseDown=function(t){e.touchX=t.clientX,e.touchY=t.clientY,document.addEventListener("mousemove",e.handleMouseMove,{capture:!0}),document.addEventListener("mouseup",e.handleMouseUp,{capture:!0})},this.handleMouseMove=function(t){e.pressVirtualKeys(e.touchX-t.clientX,e.touchY-t.clientY)},this.handleMouseUp=function(){e.releaseAllVirtualKeys(),document.removeEventListener("mousemove",e.handleMouseMove,{capture:!0}),document.removeEventListener("mouseup",e.handleMouseUp,{capture:!0})},this.cont=document.createElement("div"),this.el=document.createElement("div"),this.cont.appendChild(this.el),this.keyboardController.addHandler(this),this.assignPointerEvents()}return t.prototype.getElement=function(){return this.cont},t.prototype.loadAssets=function(){return t=this,e=void 0,r=function(){var t;return function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}(this,(function(e){switch(e.label){case 0:return t=this,[4,Q("".concat(n,"/joystick.png"))];case 1:return t.img=e.sent(),this.spriteWidth=this.img.naturalWidth/9,this.spriteHeight=this.img.naturalHeight,[2]}}))},new((i=void 0)||(i=Promise))((function(n,o){function s(t){try{h(r.next(t))}catch(t){o(t)}}function a(t){try{h(r.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}h((r=r.apply(t,e||[])).next())}));var t,e,i,r},t.prototype.build=function(){this.cont.style.cssText="\n\t\t\tposition: absolute;\n\t\t\twidth: 183px;\n\t\t\theight: 202px;\n\t\t\ttop: ".concat(e?254:493,"px;\n\t\t\tleft: ").concat(e?59:211,"px;\n\t\t\tz-index: 3;\n\t\t"),this.el.style.cssText="\n\t\t\twidth: ".concat(this.spriteWidth,"px;\n\t\t\theight: ").concat(this.spriteHeight,"px;\n\t\t\tbackground-image: URL(").concat(n,"/joystick.png);\n\t\t\tbackground-repeat: no-repeat;\n\t\t\tbackground-position: 0 0;\n\t\t\tmargin: 10px 0 0 41px;\n\t\t")},t.prototype.handle=function(t){var e=0;t.has("ArrowUp")&&t.has("ArrowRight")?e=2:t.has("ArrowUp")&&t.has("ArrowLeft")?e=4:t.has("ArrowDown")&&t.has("ArrowLeft")?e=6:t.has("ArrowDown")&&t.has("ArrowRight")?e=8:t.has("ArrowUp")?e=3:t.has("ArrowDown")?e=7:t.has("ArrowRight")?e=1:t.has("ArrowLeft")&&(e=5),e!==this.spriteIndex&&(this.spriteIndex=e,this.el.style.backgroundPosition="-".concat(this.spriteWidth*e,"px 0"))},t.prototype.assignPointerEvents=function(){"ontouchstart"in document?(this.cont.addEventListener("touchstart",this.handleTouchStart,{passive:!1}),this.cont.addEventListener("touchmove",this.handleTouchMove,{passive:!1}),this.cont.addEventListener("touchend",this.handleTouchEnd,{passive:!1})):this.cont.addEventListener("mousedown",this.handleMouseDown)},t.prototype.pressVirtualKeys=function(t,e){if(Math.abs(t)<10&&Math.abs(e)<10)this.releaseAllVirtualKeys();else{for(var n=Math.round((180+180*Math.atan2(t,e)/Math.PI)/45),i=Mt[n],r=0,o=Array.from(this.pressedVirtualKeys);r<o.length;r++){var s=o[r];i.includes(s)||(this.pressedVirtualKeys.delete(s),document.dispatchEvent(new CustomEvent("custom-keyup",{detail:s})))}for(var a=0,h=i;a<h.length;a++)s=h[a],this.pressedVirtualKeys.has(s)||(this.pressedVirtualKeys.add(s),document.dispatchEvent(new CustomEvent("custom-keydown",{detail:s})))}},t.prototype.releaseAllVirtualKeys=function(){for(var t=0,e=Array.from(this.pressedVirtualKeys);t<e.length;t++){var n=e[t];document.dispatchEvent(new CustomEvent("custom-keyup",{detail:n}))}this.pressedVirtualKeys.clear()},t.prototype.getTouchById=function(t){for(var e=0;e<t.length;e++)if(t[e].identifier===this.touchId)return t[e]},t}(),Pt=function(){function t(t){var e=this;this.keyboardController=t,this.spriteWidth=0,this.spriteHeight=0,this.spriteIndex=0,this.keyTimerId=0,this.handlePointerDown=function(t){t.preventDefault(),clearTimeout(e.keyTimerId),document.dispatchEvent(new CustomEvent("custom-keydown",{detail:"Space"}))},this.handlePointerUp=function(){clearTimeout(e.keyTimerId),e.keyTimerId=window.setTimeout((function(){document.dispatchEvent(new CustomEvent("custom-keyup",{detail:"Space"}))}),40)},this.cont=document.createElement("div"),this.el=document.createElement("div"),this.cont.appendChild(this.el),this.keyboardController.addHandler(this),this.assignPointerEvents()}return t.prototype.loadAssets=function(){return t=this,e=void 0,r=function(){var t;return function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}(this,(function(e){switch(e.label){case 0:return t=this,[4,Q("".concat(n,"/button.png"))];case 1:return t.img=e.sent(),this.spriteWidth=this.img.naturalWidth/2,this.spriteHeight=this.img.naturalHeight,[2]}}))},new((i=void 0)||(i=Promise))((function(n,o){function s(t){try{h(r.next(t))}catch(t){o(t)}}function a(t){try{h(r.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}h((r=r.apply(t,e||[])).next())}));var t,e,i,r},t.prototype.build=function(){this.cont.style.cssText="\n\t\t\tposition: absolute;\n\t\t\twidth: 161px;\n\t\t\theight: 115px;\n\t\t\ttop: ".concat(e?341:580,"px;\n\t\t\tleft: ").concat(e?372:526,"px;\n\t\t\tz-index: 4;\n\t\t"),this.el.style.cssText="\n\t\t\twidth: ".concat(this.spriteWidth,"px;\n\t\t\theight: ").concat(this.spriteHeight,"px;\n\t\t\tbackground-image: URL(").concat(n,"/button.png);\n\t\t\tbackground-repeat: no-repeat;\n\t\t\tbackground-position: 0 0;\n\t\t\tmargin: 28px 0 0 20px;\n\t\t\tz-index: 4;\n\t\t")},t.prototype.getElement=function(){return this.cont},t.prototype.handle=function(t){var e=0;(t.has("Space")||t.has("Enter")||t.has("Escape"))&&(e=1),e!==this.spriteIndex&&(this.spriteIndex=e,this.el.style.backgroundPosition="-".concat(this.spriteWidth*e,"px 0"))},t.prototype.assignPointerEvents=function(){"ontouchstart"in document?(this.cont.addEventListener("touchstart",this.handlePointerDown,{passive:!1}),this.cont.addEventListener("touchend",this.handlePointerUp,{passive:!1,capture:!0})):(this.cont.addEventListener("mousedown",this.handlePointerDown),this.cont.addEventListener("mouseup",this.handlePointerUp))},t}(),At=function(){function t(t){this.keyboardController=t,this.spriteWidth=0,this.spriteHeight=0,this.spriteIndex=0,this.broken=!1,this.animationIndices=[2,3,4,5,6,7,8,7,6,7,8,7,7,8],this.handlePointerDown=function(){document.dispatchEvent(new CustomEvent("custom-keydown",{detail:"KeyM"}))},this.handlePointerUp=function(){document.dispatchEvent(new CustomEvent("custom-keyup",{detail:"KeyM"}))},this.cont=document.createElement("div"),this.el=document.createElement("div"),this.cont.appendChild(this.el),this.keyboardController.addHandler(this),this.assignPointerEvents()}return t.prototype.loadAssets=function(){return t=this,e=void 0,r=function(){var t;return function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}(this,(function(e){switch(e.label){case 0:return t=this,[4,Q("".concat(n,"/button2.png"))];case 1:return t.img=e.sent(),this.spriteWidth=this.img.naturalWidth/9,this.spriteHeight=this.img.naturalHeight,[2]}}))},new((i=void 0)||(i=Promise))((function(n,o){function s(t){try{h(r.next(t))}catch(t){o(t)}}function a(t){try{h(r.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}h((r=r.apply(t,e||[])).next())}));var t,e,i,r},t.prototype.build=function(){this.cont.style.cssText="\n\t\t\tposition: absolute;\n\t\t\twidth: ".concat(this.spriteWidth,"px;\n\t\t\theight: ").concat(this.spriteHeight,"px;\n\t\t\ttop: ").concat(e?236:475,"px;\n\t\t\tleft: ").concat(e?223:375,"px;\n\t\t\tz-index: 4;\n\t\t"),this.el.style.cssText="\n\t\t\twidth: ".concat(this.spriteWidth,"px;\n\t\t\theight: ").concat(this.spriteHeight,"px;\n\t\t\tbackground-image: URL(").concat(n,"/button2.png);\n\t\t\tbackground-repeat: no-repeat;\n\t\t\tbackground-position: 0 0;\n\t\t\tz-index: 4;\n\t\t")},t.prototype.getElement=function(){return this.cont},t.prototype.handle=function(t){var e=this;if(!this.broken){var n=0;if(t.has("KeyM")&&(n=1),this.spriteIndex!==n)if(1===this.spriteIndex&&0===n){this.broken=!0;var i=window.setInterval((function(){var t=e.animationIndices.shift();e.el.style.backgroundPosition="-".concat(e.spriteWidth*t,"px 0"),0===e.animationIndices.length&&clearInterval(i)}),41)}else this.spriteIndex=n,this.el.style.backgroundPosition="-".concat(this.spriteWidth*n,"px 0")}},t.prototype.assignPointerEvents=function(){"ontouchstart"in document?(this.cont.addEventListener("touchstart",this.handlePointerDown),this.cont.addEventListener("touchend",this.handlePointerUp)):(this.cont.addEventListener("mousedown",this.handlePointerDown),this.cont.addEventListener("mouseup",this.handlePointerUp))},t}(),Lt=function(){function t(t,e){this.canvas=t,this.keyboardController=e,this.cont=document.createElement("div"),this.el=document.createElement("div"),this.bg=document.createElement("div"),this.el.appendChild(this.bg),this.cont.appendChild(this.el),this.joystick=new Et(this.keyboardController),this.applyButton=new Pt(this.keyboardController),this.muteButton=new At(this.keyboardController)}return t.prototype.getElement=function(){return this.cont},t.prototype.loadAssets=function(){return t=this,i=void 0,o=function(){var t,i,r;return function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}(this,(function(o){switch(o.label){case 0:return t=this,r=(i=Promise).all,[4,Q("".concat(n,e?"/machine2.png":"/machine.png"))];case 1:return[4,r.apply(i,[[o.sent(),this.joystick.loadAssets(),this.applyButton.loadAssets(),this.muteButton.loadAssets()]])];case 2:return t.img=o.sent()[0],[2]}}))},new((r=void 0)||(r=Promise))((function(e,n){function s(t){try{h(o.next(t))}catch(t){n(t)}}function a(t){try{h(o.throw(t))}catch(t){n(t)}}function h(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(t){t(n)}))).then(s,a)}h((o=o.apply(t,i||[])).next())}));var t,i,r,o},t.prototype.getSize=function(){return[this.el.offsetWidth,this.el.offsetHeight]},t.prototype.build=function(){var t=this;this.cont.draggable=!1,this.cont.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this.cont.addEventListener("touchstart",(function(t){return t.preventDefault()}),{passive:!1}),this.cont.style.cssText="\n\t\t\tuser-select: none;\n\t\t\tmax-width: 100vw;\n\t\t\toverflow: hidden;\n\t\t",this.el.style.cssText="\n\t\t\tposition: relative;\n\t\t\twidth: ".concat(this.img.naturalWidth,"px;\n\t\t\theight: ").concat(this.img.naturalHeight,"px;\n\t\t");var n=this.canvas.getElement();this.el.appendChild(n),n.style.cssText="\n\t\t\tposition: absolute;\n\t\t\tz-index: 1;\n\t\t\tmargin: ".concat(e?44:40,"px 0 0 ").concat(e?124:128,"px;\n\t\t"),this.bg.style.cssText="\n\t\t\tposition: absolute;\n\t\t\tbackground-color: #3a3a3a;\n\t\t\twidth: ".concat(a+10,"px;\n\t\t\theight: ").concat(h+10,"px;\n\t\t\tmargin: ").concat(e?39:35,"px 0 0 ").concat(e?119:123,"px;\n\t\t"),this.el.appendChild(this.img),this.img.style.cssText="\n\t\t\tposition: relative;\n\t\t\tz-index: 2;\n\t\t",this.joystick.build(),this.el.appendChild(this.joystick.getElement()),this.applyButton.build(),this.el.appendChild(this.applyButton.getElement()),this.muteButton.build(),this.el.appendChild(this.muteButton.getElement()),window.addEventListener("resize",this.updateInnerScroll.bind(this)),window.addEventListener("load",this.updateInnerScroll.bind(this));var i=0,r=window.setInterval((function(){t.updateInnerScroll(),++i>100&&clearInterval(r)}),50)},t.prototype.update=function(){this.updateInnerScroll()},t.prototype.updateInnerScroll=function(){this.el.style.marginLeft="".concat(this.cont.offsetWidth-this.el.offsetWidth>>1,"px")},t}(),Rt=function(){function e(){this.loader=new t,this.interrupter=new z,this.keyboardController=new U,this.canvas=new O,this.machine=new Lt(this.canvas,this.keyboardController),this.render=new G(this.canvas),this.loader.addItem(new V),this.loader.addItem(this.machine),this.game=new dt(this.interrupter,this.render,this.loader,this.keyboardController),this.game.events.addListener("save",this.openSaveForm.bind(this)),this.game.events.addListener("close",this.openStartMenu.bind(this)),this.saveForm=new bt(this.render,this.keyboardController),this.saveForm.events.addListener("saved",this.openTopResults.bind(this)),this.topResults=new kt(this.render,this.loader,this.keyboardController),this.topResults.events.addListener("close",this.openStartMenu.bind(this)),this.startMenu=new Ct(this.render,this.interrupter,this.loader,this.keyboardController),this.startMenu.events.addListener("game",this.openGame.bind(this)),this.startMenu.events.addListener("top-scores",this.openTopResults.bind(this))}return e.prototype.appendTo=function(t){t.appendChild(this.machine.getElement()),this.machine.update(),window.frameElement&&window.frameElement.dispatchEvent(new parent.CustomEvent("custom-load",{detail:this.machine.getSize()}))},e.prototype.start=function(){return t=this,e=void 0,i=function(){return function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}(this,(function(t){switch(t.label){case 0:return[4,this.loader.load()];case 1:return t.sent(),this.canvas.build(),this.machine.build(),this.keyboardController.attach(),this.interrupter.addItem(this.keyboardController),this.render.start(),this.interrupter.start(),this.openStartMenu(),[2]}}))},new((n=void 0)||(n=Promise))((function(r,o){function s(t){try{h(i.next(t))}catch(t){o(t)}}function a(t){try{h(i.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}h((i=i.apply(t,e||[])).next())}));var t,e,n,i},e.prototype.attachItem=function(t){this.currentItem&&this.detachCurrentItem(),this.currentItem=t,t.attach()},e.prototype.detachCurrentItem=function(){this.currentItem&&(this.keyboardController.clearPressedKeys(),this.currentItem.detach(),this.currentItem=void 0)},e.prototype.openGame=function(){this.game.reset(),this.attachItem(this.game)},e.prototype.openSaveForm=function(t){this.saveForm.setScore(t),this.attachItem(this.saveForm)},e.prototype.openTopResults=function(){this.attachItem(this.topResults)},e.prototype.openStartMenu=function(){this.attachItem(this.startMenu)},e}();document.addEventListener("DOMContentLoaded",(function(){return t=void 0,e=void 0,i=function(){var t;return function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}(this,(function(e){switch(e.label){case 0:return[4,(t=new Rt).start()];case 1:return e.sent(),t.appendTo(document.querySelector("#cont")),[2]}}))},new((n=void 0)||(n=Promise))((function(r,o){function s(t){try{h(i.next(t))}catch(t){o(t)}}function a(t){try{h(i.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}h((i=i.apply(t,e||[])).next())}));var t,e,n,i}))})();